'use strict'

const { schemaComponents } = require('@platformatic/utils')
const { transform, create: createService, schemaComponents: {plugins} } = require('@platformatic/service')


const schema = {
  $id: 'https://example.com/schemas/foo.json',
  title: 'Platformatic Service',
  type: 'object',
  properties: {
    server: schemaComponents.server,
    plugins,
    watch: schemaComponents.watch,
    $schema: { type: 'string' },
    module: { type: 'string' },
    foo: { type: 'object', properties: { text: { type: 'string' } }, required: ['text'] }
  },
  additionalProperties: false,
  required: ['server']
}

async function foo (app) {
  const text = app.platformatic.config.foo.text
  app.get('/foo', async (request, reply) => {
    return text
  })
}

async function create (path, config, context) {
  return createService(path, config, { schema, applicationFactory: foo, transform, ...context })
}

module.exports = { create }

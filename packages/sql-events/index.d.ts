/// <reference types="@platformatic/types" />
import { FastifyPluginAsync } from 'fastify'
import { Readable } from 'stream'
import { SQLMapperPluginInterface } from '@platformatic/sql-mapper'

declare module '@platformatic/types' {
  interface PlatformaticApp {
    subscribe: (topic: string | string[]) => Promise<Readable>
  }
}

export interface SQLEventsPluginOptions {
  mapper: SQLMapperPluginInterface

  // TODO mqemitter has no types
  mq?: any
  connectionString?: String
}

/**
 * Fastify plugin that add events capabilities to registered sql-mapper 
 */
declare const plugin: FastifyPluginAsync<SQLEventsPluginOptions>

export default plugin

export function setupEmitter(options: SQLEventsPluginOptions): void
